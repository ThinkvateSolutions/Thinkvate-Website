function scrollToTop(e) {
  e && e.preventDefault();
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function collapseNavbar() {
  let e = document.getElementById("navbarNavAltMarkup");
  if (e && e.classList.contains("show")) {
    window.jQuery
      ? window.jQuery(e).collapse("hide")
      : requestAnimationFrame(() => {
          e.classList.remove("show");
        });
  }
}

window.scrollToTop = scrollToTop;
window.collapseNavbar = collapseNavbar;

window.addEventListener("load", () => {
  let e = document.createElement("script");
  function t() {
    dataLayer.push(arguments);
  }
  e.async = true;
  e.src = "https://www.googletagmanager.com/gtag/js?id=YOUR_GA4_MEASUREMENT_ID";
  document.head.appendChild(e);

  window.dataLayer = window.dataLayer || [];
  window.gtag = t;

  e.onload = function () {
    t("js", new Date());
    t("config", "YOUR_GA4_MEASUREMENT_ID");
  };

  let n = () => {
    let e = document.getElementById("joinUsLink");
    if (!e) return;
    let n = e.querySelector("button");
    if (!n) return;

    e.addEventListener("click", function (o) {
      o.preventDefault();
      if (window.gtag)
        t("event", "click", {
          event_category: "Join Us Button",
          event_label: "Google Form Link",
        });

      n.innerText = "Loading...";
      let a = e.href;
      let l = window.open(a, "_blank");

      if (!l) {
        n.innerText = "Register Now";
        alert(
          "Unable to open the form. Please disable popup blockers or try again later."
        );
        return;
      }

      let i = setInterval(() => {
        if (l.closed) {
          clearInterval(i);
          n.innerText = "Register Now";
        }
      }, 500);
    });
  };

  document.readyState === "complete"
    ? n()
    : window.addEventListener("DOMContentLoaded", n);
});

document.addEventListener("visibilitychange", () => {
  if (document.visibilityState === "visible") {
    const btn = document.querySelector("#joinUsLink button");
    if (btn) btn.innerText = "Register Now";
  }
});


document.addEventListener('DOMContentLoaded', function () {
  const links = document.querySelectorAll('.link-underline-active');

  links.forEach(link => {
    link.addEventListener('click', function () {
      // Remove 'active' from all links
      links.forEach(l => l.classList.remove('active'));
      // Add 'active' to the clicked link
      this.classList.add('active');
    });
  });
});

function updateActiveSlide() {
  const track = document.getElementById("sliderTrack");
  if (!track) return;

  const slides = track.querySelectorAll(".service-slide");
  if (!slides.length) return;

  const trackRect = track.getBoundingClientRect();
  const trackCenter = trackRect.left + trackRect.width / 2;

  let closestSlide = null;
  let closestDistance = Infinity;

  slides.forEach((slide) => {
    const slideRect = slide.getBoundingClientRect();
    const slideCenter = slideRect.left + slideRect.width / 2;
    const distance = Math.abs(slideCenter - trackCenter);

    if (distance < closestDistance) {
      closestDistance = distance;
      closestSlide = slide;
    }
  });

  slides.forEach((slide) => slide.classList.remove("active"));
  if (closestSlide) closestSlide.classList.add("active");
}

function updateScrollButtons() {
  const slider = document.getElementById("sliderTrack");
  const leftBtn = document.getElementById("scrollLeftBtn");
  const rightBtn = document.getElementById("scrollRightBtn");

  if (!slider || !leftBtn || !rightBtn) return;

  // Hide left button if at the start
  if (slider.scrollLeft <= 5) {
    leftBtn.style.display = "none";
  } else {
    leftBtn.style.display = "inline-block";
  }

  // Hide right button if at the end
  if (Math.ceil(slider.scrollLeft + slider.offsetWidth) >= slider.scrollWidth - 5) {
    rightBtn.style.display = "none";
  } else {
    rightBtn.style.display = "inline-block";
  }
}

document.addEventListener("DOMContentLoaded", function () {
  const track = document.getElementById("sliderTrack");

  if (track) {
    track.addEventListener("scroll", () => {
      clearTimeout(window._highlightTimeout);
      window._highlightTimeout = setTimeout(() => {
        updateActiveSlide();
        updateScrollButtons();
      }, 100);
    });

    updateActiveSlide(); // initial highlight on load
    updateScrollButtons(); // initial button state
  }

  const scrollRightBtn = document.getElementById("scrollRightBtn");
  const scrollLeftBtn = document.getElementById("scrollLeftBtn");

  if (scrollRightBtn && track) {
    scrollRightBtn.addEventListener("click", () => {
      track.scrollBy({
        left: track.clientWidth * 0.8,
        behavior: "smooth",
      });
    });
  }

  if (scrollLeftBtn && track) {
    scrollLeftBtn.addEventListener("click", () => {
      track.scrollBy({
        left: -track.clientWidth * 0.8,
        behavior: "smooth",
      });
    });
  }
});
